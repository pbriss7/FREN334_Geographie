---
title: "G√©ographie et cartographie litt√©raires"
author: "Pascal Brissette"
format:
  html:
    toc: true
    toc-depth: 2
    toc-location: left
    code-fold: true
    code-tools: true
    theme: Yeti
    reference-location: margin
    title-block-banner: true
    self-contained: true
    standalone: true
editor: visual
lang: fr
execute:
  freeze: auto
  echo: true
  warning: false
  message: false
---

```{r}

#| echo: false
#| message: false
#| warning: false

# Fonction d'activation de packages en lot
activer_packages <- function(pkgs) {
  for (p in pkgs) {
    if (!requireNamespace(p, quietly = TRUE)) {
      install.packages(p, repos = "https://cloud.r-project.org")
    }
    suppressPackageStartupMessages(
      library(p, character.only = TRUE)
    )
  }
}

# Liste de packages √† installer (au besoin) et √† activer
packages <- c(
  "data.table", "sf", "ggplot2", "leaflet",
  "viridis", "DT", "dplyr", "reshape2", "rmarkdown"
)

activer_packages(packages)
```

# I. Qu'est-ce que la g√©ographie litt√©raire?

√Ä quel point avez-vous pr√™t√© attention √† la g√©ographie imaginaire du dernier roman que vous avez lu? Vous a-t-il sembl√© que ces lieux jouaient un r√¥le important, au point que l'histoire n'aurait pu prendre place nulle part ailleurs? Ou, au contraire, les lieux n'√©taient-ils qu'un simple d√©cor sans r√©elle importance dans la fiction? Ces lieux √©taient-ils imaginaires et sans lien avec la r√©alit√©? √âtaient-ils r√©f√©rentiels, portant des noms connus de pays, de villes ou de r√©gions historiques? Peut-√™tre √©taient-ce des lieux qui ont exist√© autrefois, des villes disparues ou portant aujourd'hui d'autres noms? Peut-√™tre encore ces lieux portaient-ils des noms √©tranges, invent√©s, mais leur description rappelaient des villes ou des r√©gions famili√®res? Y avait-il un lien entre le type d'intrigue ou la forme du roman (par exemple: un roman policier), et le type de lieux habit√©s et parcourus par les personnages? Vous est-il d√©j√† arriv√© de parcourir un quartier ou une r√©gion, et de voir ceux-ci √† travers une fiction que vous aviez d√©j√† lue? Peut-√™tre vous √™tes-vous dit: ¬´c'est ici que tel personnage a v√©cu telle √©motion, qu'il a fait telle chose, que tel √©v√©nement s'est produit.¬ª

La g√©ographie litt√©raire s'int√©resse √† ces questions et √† bien d'autres. L'expression ¬´g√©ographie litt√©raire¬ª renvoie √† une famille de travaux et de recherches qui s'int√©ressent aux liens entre la litt√©rature et l'espace.

L'exploration de ces liens peut prendre plusieurs directions.

## La litt√©rature dans l'espace

La premi√®re est celle d'une exploration entre la litt√©rature comme activit√© sociale et culturelle, et les lieux o√π elle est √©crite, publi√©e, √©dit√©e, traduite, diffus√©e, consomm√©e. Par exemple, on peut s'int√©resser √† la localisation des maisons d'√©dition ou des lieux de r√©sidence d'√©crivains, ou encore des lieux de rassemblement des associations et groupes litt√©raires dans le temps. On verrait par exemple que si l'activit√© litt√©raire au Qu√©bec s'est surtout concentr√©e dans la ville de Qu√©bec au XIXe si√®cle, elle s'est d√©plac√©e vers Montr√©al au XXe si√®cle. De tels travaux rel√®vent de l'histoire et de la sociologie de la litt√©rature. Ils s'int√©ressent √† l'activit√© ou √† la vie litt√©raire, √† ses divers acteurs et institutions, dans le temps et dans l'espace.

Un exemple de ce type d'approche: le projet ¬´Mapping Germain Fiction in Translation¬ª, de Lisa Teichmann, li√© √† sa th√®se de doctorat. Dans ce projet, L. Teichmann propose une g√©olocalisation des traductions d'ouvrages de fiction publi√©s initialement par des √©crivains allemands.

![](images/clipboard-3818084537.png)

[Geomapping Bibliographic Translation data from the German National Library Catalogue](https://lt-ladirec.shinyapps.io/GeomappingTranslationsPrototype/)

## L'espace dans la litt√©rature

La deuxi√®me est celle d'une exploration de l'espace *dans* les ≈ìuvres. Certains critique comme Bakhtine ou Moretti s'int√©ressent √† l'espace qui se d√©ploie dans des sous-groupes d'oeuvres, par exemple le roman grec antique, le roman pastoral ou encore le roman sentimental, et aux lieux typiques mis en sc√®ne et parcourus par les personnages. Moretti s'int√©resse par exemple aux romans de Jane Austen et montre qu'ils sont ancr√©s dans une partie tr√®s restreinte de l'Angleterre, une zone s√©curitaire o√π les jeunes femmes peuvent passer d'un lieu √† un autre, dans le contexte d'un march√© du mariage. Pour Bakhtine et Moretti, chaque type de roman poss√®de ou privil√©gie un type d'espace. De nombreux travaux ont √©t√© men√©s, dans cette perspective, sur le roman policier et l'espace urbain, ce type de roman se d√©ployant de mani√®re privil√©gi√©e dans les d√©dales de la ville, o√π il est ais√© de se cacher et d'√©chapper √† la police (Rosemberg, 2007). L'id√©e de ce type d'approche est de mettre en lien un type d'espace repr√©sent√© *dans* le roman et autre chose, comme le genre ou sous-genre m√™me dont rel√®ve ce roman.

On peut s'int√©resser √©galement aux parcours g√©ographiques de personnages chez un auteur en particulier ou un groupe d'auteurs (d'une m√™me √©poque, d'un m√™me courant litt√©raire, comme le romantisme, le r√©alisme, le naturalisme, etc.), ou aux connotations rattach√©es par un √©crivain aux lieux habit√©s ou parcourus par les personnages. Les lieux peuvent √™tre ouverts (parc, rue, boulevard) ou ferm√©s (maison, salon, commerce), priv√©s ou publics, centraux ou p√©riph√©riques. Ils peuvent √™tre d√©crits de l'int√©rieur, de la mani√®re dont les voit et per√ßoit les personnages, ou l'√™tre par le narrateur, de mani√®re externe.

## L'usage des cartes

On peut faire de la g√©ographie litt√©raire sans nullement recourir √† des cartes g√©ographiques! Dans l'ouvrage issu de sa th√®se de doctorat, le g√©ographe Marc Brosseau s'est int√©ress√© aux ¬´romans-g√©ographes¬ª, c'est-√†-dire √† la mani√®re dont les romans construisent, remplissent et habitent les espaces, et √† la mani√®re dont ils forment l'≈ìil humain. La g√©ographie qu'ils cr√©ent, qui peut emprunter des fragments √† la r√©alit√©, ou non, n'a rien d'un trait√© scientifique, mais le savoir sp√©cial qu'ils poss√®dent et fournissent sur les lieux humains est tr√®s pr√©cieux. L'ouvrage issu de sa th√®se explore ainsi plusieurs ≈ìuvres litt√©raires pour voir le type de g√©ographie qu'ils d√©ploient, mais sans jamais recourir √† des cartes. La seule carte g√©ographique de cet ouvrage se trouve paradoxalement sur la jaquette!

![](images/clipboard-3536775245.png)

La carte peut cependant √™tre un outil d'analyse d'un grand int√©r√™t. Elle peut servir √† r√©v√©ler des motifs, des trajectoires, des r√©gularit√©s ou des aberrations qui n'auraient pas √©t√© aussi ais√©s √† saisir sans cet outil. La carte est une autre mani√®re d'observer et de lire des ph√©nom√®nes sociaux (la distribution g√©ographique des maisons d'√©dition au Qu√©bec au XXIe si√®cle, par exemple) ou litt√©raires (le parcours typique des protagonistes du roman de formation au XIXe si√®cle, par exemple). **La carte peut donc √™tre utilis√©e aussi bien dans la premi√®re famille d'√©tudes √©voqu√©e ci-dessus (¬´la litt√©rature dans l'espace¬ª) que dans la deuxi√®me (¬´l'espace dans la litt√©rature¬ª). Selon l'objectif de la recherche, les hypoth√®ses et la m√©thode, elle peut √™tre, ou non, mobilis√©e comme outil heuristique et analytique.**

Toute carte ne repose pas sur un syst√®me d'information g√©ographique (GIS, pour Geographic Information System), c'est-√†-dire sur une convention offrant une mani√®re particuli√®re de repr√©senter le monde, de le simplifier et de le comprendre. Dans un cours de g√©ographie litt√©raire que je donnais il y a quelque temps, une √©tudiante qui venait de la r√©gion de Gatineau disait que la carte du m√©tro de Montr√©al √©tait celle qui lui avait le mieux permis de comprendre la g√©ographie montr√©alaise. Sa repr√©sentation mentale de Montr√©al et de son espace √©tait ins√©parable de cette carte. Elle ne pensait pas Montr√©al en tant que groupe de quartiers ou d'arrondissements; ce n'√©taient pas les grandes art√®res et autoroutes qui lui permettaient de circuler ou de se situer g√©ographiquement; les lignes de m√©tro et les stations √©taient ses points de r√©f√©rence. Une telle carte n'ob√©it nullement aux conventions cartographiques de Google Maps.

Les √©crivaines et √©crivains utilisent parfois des cartes pour illustrer l'espace ou le monde o√π se d√©ploient les personnages de leur univers, ou, plus m√©taphoriquement, pour illustrer le cheminement sentimental ou intellectuel que doivent effectuer leurs personnages pour r√©ussir.

![](images/Gallica_Carte_Tendre.jpg) Source: Mlle de Scud√©ry, ¬´Carte du Tendre¬ª, dans *Cl√©lie. Histoire romaine*. Gallica.

![](images/_89553428_tolkienmap2.png) Source: Tolkiens, Carte de la Terre-du-milieu, annot√©e par l'auteur de *Lord of the Ring*. BBC.

La g√©ographie litt√©raire peut ainsi prendre plusieurs directions et s'int√©resser √† de nombreux ph√©nom√®nes qui n'ont en commun qu'un int√©r√™t entre l'espace et la litt√©rature. Cet int√©r√™t peut porter sur des ph√©nom√®nes historiques ou sociologiques et leur inscription dans la g√©ographie mondiale ou nationale (*litt√©rature dans l'espace*); il peut √©galement porter sur un aspect g√©ographique intrins√®que √† la fiction, construit √† l'int√©rieur de la litt√©rature (*l'espace dans la litt√©rature*). Quant √† la cartographie, elle peut √™tre utilis√©e, ou non, comme outil d'analyse et de d√©couverte dans l'un et l'autre cas, pour faire appara√Ætre, rendre visibles des liens ou des ph√©nom√®nes li√©s au sens de l'≈ìuvre. De telles cartes peuvent s'appuyer sur les syst√®mes d'information g√©ographique, comme celui utilis√© par Google Maps, sur des cartes historiques, voire des cartes imaginaires et artistiques.

------------------------------------------------------------------------

## Concepts et d√©fis de la cartographie : discussion autour du texte de Melanie Conroy

### La m√©fiance envers la cartographie litt√©raire

Dans l'introduction de son ouvrage, Melanie Conroy rappelle que la cartographie a souvent √©t√© rejet√©e par les sp√©cialistes de la litt√©rature. M√™me ceux qui s'int√©ressent √† la g√©ographie litt√©raire s'en m√©fient, car elle est consid√©r√©e comme un geste ¬´positiviste¬ª. Qu'est-ce qu'elle veut dire par l√† et quelles raisons les sp√©cialistes peuvent-ils avoir de se m√©fier de la cartographie?

### Le processus cartographique

Conroy d√©crit un processus qui semble assez simple pour cr√©er une carte litt√©raire:

1.  Extraire les noms de lieux (toponymes).
2.  Associer ces noms √† des lieux r√©els via des r√©pertoires (gazetteers).
3.  G√©olocaliser (trouver les coordonn√©es latitude/longitude).
4.  Visualiser sur un fond de carte.

Dans les faits, cependant, ce processus n'est pas aussi ais√© et suppose des choix de la part de la ou du cartographe.

Prenons un exemple simple. *La Com√©die humaine* s'int√©resse beaucoup √† Paris. La premi√®re √©tape, celle de l'extraction du mot ¬´Paris¬ª (ou la ¬´capitale¬ª) est facile. La deuxi√®me √©tape est moins ais√©e. Pourquoi?

La troisi√®me √©tape, celle de la g√©olocalisation, peut √©galement poser quelques difficult√©s. Pourquoi? Conroy discute de cette √©tape en se r√©f√©rant √† la ¬´haussmannisation¬ª de Paris au XIXe si√®cle.

### Des lieux, mais quels lieux?

Si l'on proc√®de de mani√®re automatique √† l'extraction du mot ¬´Paris¬ª dans *La Com√©die humaine*, nous obtiendrons une grande quantit√© d'occurrences. Cependant, dans le texte, le mot a-t-il toujours la m√™me valeur et la m√™me signification? Si je m'int√©resse aux d√©placements des personnages, le mot ¬´Paris¬ª en tant que tel sera plus ou moins pertinent. Pourquoi?

Barbara Piatti, qui a dirig√© un ambitieux projet d'Atlas du roman europ√©en, s'est beaucoup int√©ress√©e √† un autre enjeu de la cartographie litt√©raire. Elle remarque en effet que les lieux litt√©raires, contrairement √† ceux cartographi√©s scientifiquement, ont rarement des fronti√®res claires. Ce sont souvent davantage des zones aux fronti√®res floues que des lieux aux limites nettes. Elle propose une typologie des lieux en cinq points:

1.  `Setting`: un lieu o√π l'action prend place, occup√© par les personnages;
2.  `Zone of action`: plusieurs `settings` formant une zone ou une r√©gion (ex.: r√©gion de Paris);
3.  `Projected space`: les personnages ne s'y trouvent pas, mais ils s'y r√©f√®rent, s'en souviennent, aspirent √† y aller, etc.;
4.  `Marker`: lieux mentionn√©s, par exemple par la narration, mais agissant davantage comme un point de rep√®re dans l'espace que comme un lieu investi √©motionnellement;
5.  `Route`: le long desquelles les personnages se d√©placent (d'un `setting` √† un autre).

## Pour aller plus loin

-   Mikha√Øl Bakhtine, *Esth√©tique et th√©orie du roman*, traduit du russe par Daria Olivier, Paris, Gallimard, 1978 \[1975\].

-   Rachel Bouvet (√©d.), *Litt√©rature et g√©ographie*, Montr√©al, Presses de l'Universit√© du Qu√©bec, 2018.

-   Marc Brosseau, *Les romans-g√©ographes. Essais*, Paris, L'Harmattan, coll. ¬´G√©ographie et cultures¬ª, 1996.

-   Michel Collot, *Pour une g√©ographie litt√©raire*, Paris, √âditions Corti, coll. ¬´Les essais¬ª, 2014.

-   Melanie Conroy, *Literary Geographies in Balzac and Proust*, Cambridge, Cambridge University Press, coll. ¬´Elements in Digital Literary Studies¬ª, 2021.

-   Franco Moretti, *Graphes, cartes et arbres. Mod√®les abstraits pour une autre histoire de la litt√©rature*, traduit de l'anglais par √âtienne Dobenesque, Paris, Les prairies ordinaires, coll. ¬´Penser/croiser¬ª, 2008.

-   Barbara Piatti, Anne-Kathrin Reuschel, Hans Rudolf B√§r, William Cartwright et Lorenz Hurni, ¬´Mapping Literature. Towards a Geography of Fiction¬ª, dans Cartwright, W. et al. *Cartography and Art*, Wiesbaden, p. 177-192. <https://www.literaturatlas.eu/files/2012/01/Piatti2008_ArtAndCartography_Springer.pdf>

-   Muriel Rosemberg (dir.), *G√©ographie et cultures*, ¬´Le roman policier. Lieux et itin√©raires¬ª, no 61, 2007.

-   Lisa Teichmann, ¬´Mapping German fiction in translation in the German National Library catalogue (1980-2020)¬ª, Department of Language, Literature and Culture, Universit√© McGill, 2023. <https://escholarship.mcgill.ca/concern/theses/0p096d03z?locale=en>

------------------------------------------------------------------------

# II. Atelier de cartographie litt√©raire ‚Äî Le Paris de *La Com√©die humaine*

Pour ce premier atelier, nous allons utiliser les donn√©es compil√©es de diverses sources par Melanie Conroy dans le cadre de sa recherche sur la g√©ographie balzacienne. Chemin faisant, nous allons faire nos premiers pas avec la structure de donn√©es la plus utilis√©e, le tableau de donn√©es.

## Consultation des donn√©es dans un logiciel

La premi√®re mani√®re de consulter les donn√©es compil√©es par Conroy ‚Äî et la plus simple ‚Äî, est de passer par l'interface [`Tableau public`](https://public.tableau.com/app/profile/melanie.conroy/viz/BalzacsParis/BalzacsParis "Mapping Balzac - Tableau"). En cliquant sur le lien pr√©c√©dent, vous pourrez consulter trois graphiques exploitant les donn√©es.

1.  Une projection des lieux nomm√©s sous forme de points: les couleurs sont associ√©es √† des titres d'ouvrages et la taille, au nombre d'occurrences;
2.  Une projection des lieux nomm√©s dans un diagramme circulaire (tarte), avec les m√™mes caract√©ristiques esth√©tiques;
3.  Un diagramme √† barres montrant, pour chaque roman, l'importance des quartiers li√©s √† des mentions de lieux.

**Exercice**:

1.  Sous l'onglet 3 (diagramme √† barres), commencez par rep√©rer le roman *Illusions perdues*. Quel est le quartier le plus important? Avez-vous une id√©e de ce qui s'y trouve et s'y passe?
2.  Sous l'onglet 2 (diagramme circulaire), rep√©rez les lieux cl√©s du Paris des ≈ìuvres de Balzac. Quels sont ces lieux et pourquoi sont-ils essentiels √† la dynamique de *La Com√©die humaine*?

------------------------------------------------------------------------

## Consultation des donn√©es brutes

L'interface graphique de Tableau est attrayante, mais elle est limit√©e: nous ne pouvons interagir qu'avec les donn√©es que l'auteure a souhait√© montrer. Il peut √™tre int√©ressant de retourner aux donn√©es brutes pour plusieurs raisons:

1.  Il est toujours utile et important de regarder l'√©tat des donn√©es et de la structure. Dans certains cas, on peut rapidement rep√©rer des probl√®mes de coh√©rence ou des enjeux d'uniformisation, puis les corriger.
2.  Les donn√©es pourraient √™tre beaucoup plus riches que ne le laisse croire l'interface Tableau: il est possible que la structure brute contienne des colonnes permettant d'√©tendre l'enqu√™te;
3.  M√™me si les donn√©es ne correspondent pas parfaitement √† ce que nous cherchons, nous pourrons peut-√™tre en extraire quelques √©l√©ments que nous pourrons ensuite enrichir.

Les donn√©es utilis√©es pour cr√©er les graphiques de Tableau ont √©t√© d√©pos√©es par Melanie Conroy sur son compte Github. Github est un espace de partage et de collaboration permettant aux programmeurs et d√©veloppeurs de rendre publics du code et des donn√©es.

[`Mapping Balzac -- Github`](https://github.com/mrconroy/mapping-balzac "Mapping Balzac - Github")

Cliquez sur [`MappingBalzac_Paris_Comedie_Humaine.tsv`](https://github.com/mrconroy/mapping-balzac/blob/master/MappingBalzac_Paris_Comedie%20Humaine.tsv "MappingBalzac_Paris_Comedie_Humaine.tsv") pour voir l'√©tat des donn√©es.

Que remarquez-vous?

## Consultation des donn√©es nettoy√©es

Un petit coup de balai est essentiel pour rendre ces donn√©es exploitables. Entre autres, les caract√®res latins ont √©t√© syst√©matiquement corrig√©s √† l'aide d'un logiciel sp√©cialis√© (OpenRefine).

En cliquant sur la fl√®che ![](images/clipboard-3589718497.png){width="20"} du bloc ci-dessous, Posit ex√©cutera les lignes de commande et vous pourrez visualiser les trois premi√®res lignes de la structure de donn√©es.

```{r}
#| label: setup
#| echo: true

# 1. D√©finition des noms de colonnes
noms_colonnes <- c(
  "livre", "book", "vol", "series", "series_ch", "start_page", "end_page",
  "region", "type_of_place", "place_raw", "place_raw_paris_france", "quartier",
  "lat", "long", "description", "types_involved", "characters_full_name",
  "characters_csv", "shop_name", "store_type", "historical_figures", "date",
  "wiki_url", "image_url", "discourse"
)

# 2. Importation et nettoyage initial des donn√©es
dt <- fread("donnees/MappingBalzacParis_final.csv", quote = "\"", col.names = noms_colonnes)

# Nettoyage des coordonn√©es d√®s l'importation.
# On s'assure que lat et long sont des nombres (numeric).
# na.omit() supprime les lignes o√π les coordonn√©es sont manquantes.
dt <- dt[, `:=`(lat = as.numeric(lat), long = as.numeric(long))][!is.na(lat) & !is.na(long)]

# Nettoyage de la variable 'discourse'
dt[is.na(discourse) | !(discourse %in% c("Fact", "Event", "Description")), discourse := "Autre"]

# Ajout d'un identifiant unique pour chaque ligne, utile pour les jointures
dt[, row_id := .I]

# Affichage des premi√®res lignes pour v√©rification
datatable(head(dt, 3))
```

Cette structure de donn√©es, tr√®s commune, est une table plate ou ¬´tableau de donn√©es¬ª (*data frame* en anglais). Il comporte deux dimensions, avec des lignes et des colonnes. Si vous avez d√©j√† travaill√© avec Excel, vous ne serez pas perturb√© outre mesure par cette structure.

**Question**: de quoi sont form√©es, ici, les lignes et les colonnes? Il est tr√®s important de comprendre cette structure pour pouvoir l'exploiter ad√©quatement.

**Question**: d'apr√®s vous, est-ce que toutes les colonnes ont √©t√© exploit√©es par Conroy dans l'interface Tableau?

### Partie 1 ‚Äî Exploration des donn√©es, une dimension √† la fois

Avant d'aller plus loin, faisons une petite pause terminologique.

Quand on travaille avec un tableau de donn√©es, il est utile d‚Äôavoir un vocabulaire simple et commun pour en parler. Quelques mots-cl√©s suffisent pour commencer : **population**, **individus**, **variables**, **valeur** et **type de donn√©e**.

La **population** correspond √† l‚Äôensemble sur lequel porte notre observation. Par exemple, tous les livres ou articles de notre corpus.

On appellera **individus** chaque √©l√©ment de cette population occupant une ligne du tableau, par exemple chaque livre ou article de notre corpus.

Enfin, on appellera **variables** les caract√©ristiques que nous mesurons ou notons pour chaque individu. Le nom de l'auteur, l'ann√©e de publication, la maison d'√©dition, les sujets dont traite chaque ouvrage du tableau.

Au croisement des lignes et des colonnes, donc des individus et des variables, se trouvent les **valeurs**.

Une **valeur**, c‚Äôest l‚Äôinformation pr√©cise enregistr√©e pour un individu donn√© sur une variable donn√©e.

‚Ä¢ Exemple : si la variable est ¬´ √¢ge ¬ª, et que l‚Äôindividu est Alice, la valeur peut √™tre ¬´ 20 ¬ª.

Les **types de donn√©es.** Dans un tableau bien fait, toutes les valeurs d‚Äôune m√™me variable doivent √™tre du m√™me type. C‚Äôest ce type qui d√©termine la nature des informations qu‚Äôon peut enregistrer et les op√©rations possibles.

Les principaux types de donn√©es sont : ‚Ä¢ cha√Ænes de caract√®res (strings) : par exemple ¬´ Paris ¬ª, ¬´ Nantes ¬ª, ¬´ Angoul√™me ¬ª ; ‚Ä¢ nombres entiers (integers) : 1, 2, 3, 4 ; ‚Ä¢ nombres d√©cimaux (floats) : 1.1, 1.5, 4.5 ; ‚Ä¢ bool√©ens (booleans) : TRUE ou FALSE (oui/non, pr√©sent/absent).

üëâ Dans une colonne donn√©e, on ne retrouve donc qu‚Äôun seul type de donn√©es, ce qui garantit la coh√©rence de la variable et la possibilit√© d‚Äôeffectuer des calculs ou des regroupements pertinents.

Fin de la pause terminologique!

Devant un tableau comportant autant d'individus (4408) et de variables (25), on peut se sentir un peu perdu. Aussi, la premi√®re chose √† faire est une exploration univari√©e, c'est-√†-dire un regroupement des valeurs identiques d'une seule variable, question de voir l'importance de chaque groupe.

Dans le bloc suivant, nous allons cr√©er notre premier regroupement: nous allons d'abord observer les diff√©rentes valeurs entr√©es par Melanie Conroy pour la variable `discourse`, puis nous allons calculer la fr√©quence de chacune de ces cat√©gories.

```{r}

unique(dt$discourse)

```

```{r}
dt[, .N, discourse][order(-N)]
```

Nous pourrions proposer le m√™me examen pour chacune des variables cat√©gorielles (c'est-√†-dire les variables pour lesquelles les valeurs sont des cat√©gories, g√©n√©ralement en nombre limit√©). Essayez par exemple de remplacer `discourse` par `type_of_place` dans la derni√®re ligne de code, puis ex√©cutez le bloc.

#### Notre premier diagramme √† barres

Avec une table de fr√©quence comme celle que nous venons de composer, nous pouvons fabriquer un diagramme √† barres. Chaque valeur de la variable correspondra √† une barre et la hauteur de celle-ci sera d√©termin√©e par la fr√©quence (le nombre entier dans la deuxi√®me colonne du tableau).

Le bloc ci-dessous offre une fonction maison permettant de cr√©er un tel diagramme √† barres pour une variable donn√©e. Changez par exemple la variable `discourse` par `type_of_place` dans la fonction, puis ex√©cutez le bloc.

```{r}
#| label: "exploration_categorielle_avancee"
#| fig-cap: "Exploration des variables cat√©gorielles avec options"
#| warning: false
#| message: false


plot_distribution <- function(data, variable, titre, max = 15, viridis = TRUE) {
  # Filtrage des valeurs vides ou manquantes
  data_filtr√©e <- data[get(variable) != "" & !is.na(get(variable))]
  
  # Comptage des occurrences
  freq <- data_filtr√©e[, .N, by = variable][order(-N)][1:max]
  noms_ordonnes <- freq[[variable]]
  
  # Sous-ensemble des donn√©es
  data_top <- data_filtr√©e[get(variable) %in% noms_ordonnes]
  
  # Trac√©
  p <- ggplot(data_top, aes(x = reorder(get(variable), -table(get(variable))[get(variable)]))) +
    geom_bar(aes(fill = ..count..)) +
    labs(title = titre, x = variable, y = "Nombre de mentions") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
  
  # Option de coloration viridis
  if (viridis) {
    p <- p + scale_fill_viridis_c(option = "D", direction = -1, end = 0.9)
  }
  
  return(p)
}

plot_distribution(dt, "discourse", "R√©partition des types de lieux")


```

√Ä nouveau, changez `discourse` par une autre variable, `type_of_place`, puis ex√©cutez √† nouveau le bloc.

### Exploration cartographique

Comme le jeu de donn√©es de Melanie Conroy a √©t√© g√©or√©f√©renc√© et que chaque entr√©e poss√®de une valeur de latitude et une de longitude, il est possible de projeter chaque individu sur une carte sous la forme d'un petit point. Si vous retournez au [`premier onglet de Tableau -- Mapping Balzac`](https://public.tableau.com/app/profile/melanie.conroy/viz/BalzacsParis/BalzacsParis "Mapping Balzac"), vous verrez de ces points.

**Question**: pourquoi certains de ces points sont-ils plus volumineux?

Pour rendre la carte plus lisible, il est souvent souhaitable d'**agr√©ger** les points qui occupent la m√™me position g√©ographique. Ainsi, la taille du point sera proportionnelle au nombre de fois que les coordonn√©es identiques se trouvent dans le jeu de donn√©es.

Une autre mani√®re de simplifier et d'agr√©ger les donn√©es g√©ographiques est de les rassembler √† l'int√©rieur d'une zone donn√©e de la carte, et de colorer la carte en fonction de la densit√© des points.

Dans le bloc de code ci-dessous, j'utilise la carte des arrondissements contemporains de Paris ([`donn√©es disponibles ici`](https://opendata.paris.fr/explore/dataset/arrondissements/export/?disjunctive.l_ar&disjunctive.c_arinsee&disjunctive.c_ar&location=13,48.85156,2.32327 "Arrondissements de Paris")). Chaque arrondissement est form√© de coordonn√©es qui forment un polygone. On d√©termine combien de points uniques du jeu de donn√©es de Conroy ¬´tombent¬ª dans chaque polygone, puis on colore chaque polygone en fonction d'une √©chelle gradu√©e. Ce type de carte est appel√© **choropl√®the**.

```{r}
#| label: "preparation_carte_choroplethe"
#| message: false
#| warning: false

# --- √âtape 1: Pr√©paration des objets g√©ospatiaux ---

# Chargement du fichier GeoJSON des arrondissements de Paris.
# st_transform(4326) s'assure que le syst√®me de coordonn√©es est le m√™me que celui de nos points (WGS84).
arrondissements <- st_read("donnees/arrondissements.geojson", quiet = TRUE) |>
  st_transform(4326)

# Conversion de notre data.table en objet 'sf' (simple features).
# On sp√©cifie que les colonnes 'long' et 'lat' sont les coordonn√©es.
points_sf <- st_as_sf(dt, coords = c("long", "lat"), crs = 4326, remove = FALSE)

# --- √âtape 2: Jointure spatiale ---

# On effectue une jointure spatiale pour savoir dans quel arrondissement se trouve chaque point.
# `st_join` ajoute les colonnes des arrondissements (ex: c_ar, l_ar) aux points situ√©s √† l'int√©rieur.
points_avec_arrond <- st_join(points_sf, arrondissements, join = st_within)

# --- √âtape 3: Comptage des mentions par arrondissement ---

# On repasse en data.table pour une agr√©gation rapide.
dt_final <- as.data.table(points_avec_arrond)

# On compte le nombre de mentions (N) par arrondissement (`l_ar`).
# On filtre les points qui n'ont pas trouv√© d'arrondissement (NA).
comptes_arrond <- dt_final[!is.na(l_ar), .N, by = .(l_ar, c_ar)]
setnames(comptes_arrond, "N", "mentions") # On renomme la colonne pour plus de clart√©

# --- √âtape 4: Jointure des comptes au g√©o-r√©f√©rentiel ---

# On joint nos comptes √† l'objet spatial 'arrondissements'.
# `merge` est utilis√© ici pour la jointure.
arrondissements_avec_comptes <- merge(arrondissements, comptes_arrond, by = c("l_ar", "c_ar"), all.x = TRUE)

# On remplace les NA (arrondissements sans mention) par 0.
arrondissements_avec_comptes$mentions[is.na(arrondissements_avec_comptes$mentions)] <- 0


# --- √âtape 5: Cr√©ation de la carte interactive Leaflet ---

pal <- colorNumeric(palette = "viridis", domain = arrondissements_avec_comptes$mentions, reverse = TRUE)

carte_choroplethe <- leaflet(arrondissements_avec_comptes) %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~pal(mentions),
    weight = 2,
    opacity = 1,
    color = "white",
    dashArray = "3",
    fillOpacity = 0.7,
    popup = ~paste(
      "<strong>Arrondissement :</strong>", l_ar, "<br>",
      "<strong>Nombre de mentions :</strong>", mentions, "<br>",
      "<strong>Pourcentage du total :</strong>",
      round(mentions / sum(mentions, na.rm = TRUE) * 100, 1), "%"
    ),
    highlightOptions = highlightOptions(
      weight = 3, color = "#666", dashArray = "",
      fillOpacity = 0.9, bringToFront = TRUE
    )
  ) %>%
  addLegend(
    pal = pal, values = ~mentions, opacity = 0.7,
    title = "Nombre de<br>mentions", position = "bottomright"
  ) %>%
  setView(lng = 2.34, lat = 48.86, zoom = 11)

carte_choroplethe
```

Le Paris de Balzac est fortement concentr√© autour des arrondissements centraux de la rive droite.

# Exploration avanc√©e: l'analyse bivari√©e

√Ä quel type de question l'analyse univari√©e permet-elle de r√©pondre?

-   ¬´Quels sont les lieux souvent mentionn√©s dans les romans de Balzac?¬ª

Ce type d'exploration, une donn√©e √† la fois, √† l'aide de diagrammes √† barres ou de cartes g√©ographiques, permet certes de rep√©rer des tendances fortes ou faibles, mais il ne permet pas encore de comprendre le lien *entre* les variables.

Pour cela, il faut croiser les valeurs de deux colonnes ou plus, et compter le nombre de fois que des paires de valeurs sont trouv√©es.

Supposons par exemple que j'aie cr√©√© un jeu de donn√©es dans lequel se trouve dix romans de Balzac (un par ligne) et que j'aie not√©, pour chacun, le lieu du d√©but du roman (lieu_debut) et le lieu o√π le roman se termine (lieu_fin).

```{r}

# Cr√©ation du jeu de donn√©es exemple

balzac_romans <- data.frame(
  roman = c("Le P√®re Goriot", "Eug√©nie Grandet", "La Cousine Bette", 
            "Le Cousin Pons", "C√©sar Birotteau", "La Peau de chagrin",
            "Illusions perdues", "Splendeurs et mis√®res", "La Femme de trente ans",
            "Le Lys dans la vall√©e"),
  lieu_debut = c("Paris", "Saumur", "Paris", "Paris", "Paris", "Paris",
                 "Angoul√™me", "Paris", "Paris", "Tours"),
  lieu_fin = c("Paris", "Saumur", "Paris", "Paris", "Paris", "Alpes",
               "Paris", "Paris", "Normandie", "Tours"),
  annee_publication = c(1835, 1833, 1846, 1847, 1837, 1831, 1843, 1847, 1842, 1836)
)

# Affichage du tableau
balzac_romans
```

Dans le contexte d'une analyse bivari√©e, on posera des questions comme les suivantes:

¬´Y a-t-il une **relation** entre le lieu de d√©but et le lieu de fin des romans ?¬ª ¬´Les romans qui commencent √† Paris finissent-ils g√©n√©ralement √† Paris ?¬ª ¬´Observe-t-on des patterns de mobilit√© g√©ographique selon l'√©poque de publication ?¬ª

Pour r√©pondre √† ce type de question, il faut construire un petit tableau o√π nous noterons le nombre d'occurrences de chaque paire. C'est ce qu'on appelle un tableau de contingence

```{r}
# Tableau de contingence : lieu_debut √ó lieu_fin
tableau_cooc <- table(balzac_romans$lieu_debut, balzac_romans$lieu_fin)
print(tableau_cooc)

# Ou avec dplyr pour plus de flexibilit√©
contingence <- balzac_romans %>%
  count(lieu_debut, lieu_fin, name = "frequence") %>%
  arrange(desc(frequence))

print(contingence)
```

Les donn√©es d'un tableau de contingence peuvent √™tre projet√©s dans une carte de chaleur:

```{r}

# Heatmap pour visualiser les croisements
ggplot(contingence, aes(x = lieu_debut, y = lieu_fin, fill = frequence)) +
  geom_tile() +
  geom_text(aes(label = frequence), color = "white", size = 4) +
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  labs(title = "Carte de chaleur de la mobilit√© g√©ographique",
       x = "Lieu de d√©but", 
       y = "Lieu de fin",
       fill = "Fr√©quence") +
  theme_minimal()
```

Nous allons maintenant faire cela avec de ¬´vraies¬ª donn√©es, cette fois, celles du tableau de Melanie Conroy.

Nous allons, en guise d'exemple, croiser les modalit√©s de la variable **s√©rie litt√©raire** (¬´Sc√®nes de la vie parisienne¬ª, ¬´Sc√®nes de la vie de province¬ª, etc.) et celles de la variable **r√©gion g√©ographique** pour v√©rifier que Balzac situe bien en province les ¬´Sc√®nes de la vie de province¬ª!

Les noms de variables √† utiliser ici sont `series_ch` pour la s√©rie litt√©raire et `region` pour la r√©gion g√©ographique.

```{r}
#| label: "preparation_heatmap"
#| warning: false
#| message: false


# Nettoyage des valeurs vides
dt_filtr√© <- dt[series_ch != "" & !is.na(series_ch) & region != "" & !is.na(region)]

# Cr√©ation de la matrice de cooccurrences
matrice_cooc <- dcast(
  dt_filtr√©[, .N, by = .(series_ch, region)],
  series_ch ~ region,
  value.var = "N",
  fill = 0
)

# Aper√ßu des donn√©es agr√©g√©es
head(matrice_cooc)
```

Le bloc suivant, quant √† lui, cr√©e la carte de chaleur et rend visible les croisements de donn√©es.

```{r}
#| label: "plot_heatmap_simple"
#| fig-cap: "Carte de chaleur simplifi√©e"
#| warning: false
#| message: false

# Fonction simplifi√©e pour tracer une carte de chaleur √† partir d'une matrice
plot_heatmap <- function(matrice, titre = "Carte de chaleur") {
  
  # Conversion en format long
  data_long <- melt(matrice, id.vars = colnames(matrice)[1], variable.name = "colonne", value.name = "N")
  
  ggplot(data_long, aes_string(x = "colonne", y = colnames(matrice)[1], fill = "N")) +
    geom_tile(color = "white") +
    scale_fill_viridis_c(option = "C", direction = -1) +
    labs(title = titre, x = "Variable 2", y = "Variable 1", fill = "Fr√©quence") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

plot_heatmap(matrice_cooc, "Carte de chaleur : s√©ries √ó r√©gions")

```

On n'est pas surpris de voir que les *Sc√®nes de la vie parisienne* sont **fortement corr√©l√©es** avec la Cit√© et les Boulevards, o√π l'on trouve les th√©√¢tres et les divertissements, mais il est plus surprenant de voir que les *Sc√®nes de la vie de province* contiennent √©galement un nombre √©lev√© de r√©f√©rences aux m√™mes Boulevards. Avez-vous une hypoth√®se pour expliquer ce ph√©nom√®ne?

Nous pouvons isoler, dans table initiale, les romans des *Sc√®nes de la vie de province* et voir lesquels font le plus souvent r√©f√©rence aux Boulevards.

```{r}

dt_pie <- dt[series_ch == "Sc√®nes de la vie de province" & region == "The Boulevards",
             .N, by = "livre"][order(-N)]
dt_pie
dt_pie |>
  ggplot(aes(x = "", y = N, fill = reorder(livre, -N))) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  geom_text(aes(label = N),   # <- ajouter les √©tiquettes
            position = position_stack(vjust = 0.5),  # centre
            color = "white",                         # couleur contrast√©e
            size = 4) +                               # taille ajustable
  coord_polar("y", start = 0) +
  theme_void()


```

Ainsi, *Illusions perdues* est le titre des *Sc√®nes de la vie de province* qui se r√©f√®re le plus √† Paris et, comme on sait, toute la partie centrale du roman, ¬´Un grand homme de province √† Paris¬ª, s'y d√©roule.
