---
title: "Géographie et cartographie littéraires"
author: "Pascal Brissette"
format:
  html:
    toc: true
    toc-depth: 2
    toc-location: left
    code-fold: true
    code-tools: true
    theme: Yeti
    reference-location: margin
    title-block-banner: true
    self-contained: true
    standalone: true
editor: visual
lang: fr
execute:
  freeze: auto
  echo: true
  warning: false
  message: false
---

```{r}

#| echo: false
#| message: false
#| warning: false

if(!"data.table" %in% rownames(installed.packages())) {install.packages("data.table")}
if(!"sf" %in% rownames(installed.packages())) {install.packages("sf")}
if(!"tidyverse" %in% rownames(installed.packages())) {install.packages("tidyverse")}
if(!"leaflet" %in% rownames(installed.packages())) {install.packages("leaflet")}
if(!"leaflet.providers" %in% rownames(installed.packages())) {install.packages("leaflet.providers")}
if(!"viridis" %in% rownames(installed.packages())) {install.packages("viridis")}
if(!"DT" %in% rownames(installed.packages())) {install.packages("DT")}

library(data.table)
library(sf)
library(leaflet)
library(leaflet.providers)
library(viridis)
library(DT)

```

# I. Qu'est-ce que la géographie littéraire?

À quel point avez-vous prêté attention à la géographie imaginaire du dernier roman que vous avez lu? Vous a-t-il semblé que ces lieux jouaient un rôle important, au point que l'histoire n'aurait pu prendre place nulle part ailleurs? Ou, au contraire, les lieux n'étaient-ils qu'un simple décor sans réelle importance dans la fiction? Ces lieux étaient-ils imaginaires et sans lien avec la réalité? Étaient-ils référentiels, portant des noms connus de pays, de villes ou de régions historiques? Peut-être étaient-ce des lieux qui ont existé autrefois, des villes disparues ou portant aujourd'hui d'autres noms? Peut-être encore ces lieux portaient-ils des noms étranges, inventés, mais leur description rappelaient des villes ou des régions familières? Y avait-il un lien entre le type d'intrigue ou la forme du roman (par exemple: un roman policier), et le type de lieux habités et parcourus par les personnages? Vous est-il déjà arrivé de parcourir un quartier ou une région, et de voir ceux-ci à travers une fiction que vous aviez déjà lue? Peut-être vous êtes-vous dit: «c'est ici que tel personnage a vécu telle émotion, qu'il a fait telle chose, que tel événement s'est produit.»

La géographie littéraire s'intéresse à ces questions et à bien d'autres. L'expression «géographie littéraire» renvoie à une famille de travaux et de recherches qui s'intéressent aux liens entre la littérature et l'espace.

L'exploration de ces liens peut prendre plusieurs directions.

## La littérature dans l'espace

La première est celle d'une exploration entre la littérature comme activité sociale et culturelle, et les lieux où elle est écrite, publiée, éditée, traduite, diffusée, consommée. Par exemple, on peut s'intéresser à la localisation des maisons d'édition ou des lieux de résidence d'écrivains, ou encore des lieux de rassemblement des associations et groupes littéraires dans le temps. On verrait par exemple que si l'activité littéraire au Québec s'est surtout concentrée dans la ville de Québec au XIXe siècle, elle s'est déplacée vers Montréal au XXe siècle. De tels travaux relèvent de l'histoire et de la sociologie de la littérature. Ils s'intéressent à l'activité ou à la vie littéraire, à ses divers acteurs et institutions, dans le temps et dans l'espace.

Un exemple de ce type d'approche: le projet «Mapping Germain Fiction in Translation», de Lisa Teichmann, lié à sa thèse de doctorat. Dans ce projet, L. Teichmann propose une géolocalisation des traductions d'ouvrages de fiction publiés initialement par des écrivains allemands.

![](images/clipboard-3818084537.png)

[Geomapping Bibliographic Translation data from the German National Library Catalogue](https://lt-ladirec.shinyapps.io/GeomappingTranslationsPrototype/)

## L'espace dans la littérature

La deuxième est celle d'une exploration de l'espace *dans* les œuvres. Certains critique comme Bakhtine ou Moretti s'intéressent à l'espace qui se déploie dans des sous-groupes d'oeuvres, par exemple le roman grec antique, le roman pastoral ou encore le roman sentimental, et aux lieux typiques mis en scène et parcourus par les personnages. Moretti s'intéresse par exemple aux romans de Jane Austen et montre qu'ils sont ancrés dans une partie très restreinte de l'Angleterre, une zone sécuritaire où les jeunes femmes peuvent passer d'un lieu à un autre, dans le contexte d'un marché du mariage. Pour Bakhtine et Moretti, chaque type de roman possède ou privilégie un type d'espace. De nombreux travaux ont été menés, dans cette perspective, sur le roman policier et l'espace urbain, ce type de roman se déployant de manière privilégiée dans les dédales de la ville, où il est aisé de se cacher et d'échapper à la police (Rosemberg, 2007). L'idée de ce type d'approche est de mettre en lien un type d'espace représenté *dans* le roman et autre chose, comme le genre ou sous-genre même dont relève ce roman.

On peut s'intéresser également aux parcours géographiques de personnages chez un auteur en particulier ou un groupe d'auteurs (d'une même époque, d'un même courant littéraire, comme le romantisme, le réalisme, le naturalisme, etc.), ou aux connotations rattachées par un écrivain aux lieux habités ou parcourus par les personnages. Les lieux peuvent être ouverts (parc, rue, boulevard) ou fermés (maison, salon, commerce), privés ou publics, centraux ou périphériques. Ils peuvent être décrits de l'intérieur, de la manière dont les voit et perçoit les personnages, ou l'être par le narrateur, de manière externe.

## L'usage des cartes

On peut faire de la géographie littéraire sans nullement recourir à des cartes géographiques! Dans l'ouvrage issu de sa thèse de doctorat, le géographe Marc Brosseau s'est intéressé aux «romans-géographes», c'est-à-dire à la manière dont les romans construisent, remplissent et habitent les espaces, et à la manière dont ils forment l'œil humain. La géographie qu'ils créent, qui peut emprunter des fragments à la réalité, ou non, n'a rien d'un traité scientifique, mais le savoir spécial qu'ils possèdent et fournissent sur les lieux humains est très précieux. L'ouvrage issu de sa thèse explore ainsi plusieurs œuvres littéraires pour voir le type de géographie qu'ils déploient, mais sans jamais recourir à des cartes. La seule carte géographique de cet ouvrage se trouve paradoxalement sur la jaquette!

![](images/clipboard-3536775245.png)

La carte peut cependant être un outil d'analyse d'un grand intérêt. Elle peut servir à révéler des motifs, des trajectoires, des régularités ou des aberrations qui n'auraient pas été aussi aisés à saisir sans cet outil. La carte est une autre manière d'observer et de lire des phénomènes sociaux (la distribution géographique des maisons d'édition au Québec au XXIe siècle, par exemple) ou littéraires (le parcours typique des protagonistes du roman de formation au XIXe siècle, par exemple). **La carte peut donc être utilisée aussi bien dans la première famille d'études évoquée ci-dessus («la littérature dans l'espace») que dans la deuxième («l'espace dans la littérature»). Selon l'objectif de la recherche, les hypothèses et la méthode, elle peut être, ou non, mobilisée comme outil heuristique et analytique.**

Toute carte ne repose pas sur un système d'information géographique (GIS, pour Geographic Information System), c'est-à-dire sur une convention offrant une manière particulière de représenter le monde, de le simplifier et de le comprendre. Dans un cours de géographie littéraire que je donnais il y a quelque temps, une étudiante qui venait de la région de Gatineau disait que la carte du métro de Montréal était celle qui lui avait le mieux permis de comprendre la géographie montréalaise. Sa représentation mentale de Montréal et de son espace était inséparable de cette carte. Elle ne pensait pas Montréal en tant que groupe de quartiers ou d'arrondissements; ce n'étaient pas les grandes artères et autoroutes qui lui permettaient de circuler ou de se situer géographiquement; les lignes de métro et les stations étaient ses points de référence. Une telle carte n'obéit nullement aux conventions cartographiques de Google Maps.

Les écrivaines et écrivains utilisent parfois des cartes pour illustrer l'espace ou le monde où se déploient les personnages de leur univers, ou, plus métaphoriquement, pour illustrer le cheminement sentimental ou intellectuel que doivent effectuer leurs personnages pour réussir.

![](images/Gallica_Carte_Tendre.jpg) Source: Mlle de Scudéry, «Carte du Tendre», dans *Clélie. Histoire romaine*. Gallica.

![](images/_89553428_tolkienmap2.png) Source: Tolkiens, Carte de la Terre-du-milieu, annotée par l'auteur de *Lord of the Ring*. BBC.

La géographie littéraire peut ainsi prendre plusieurs directions et s'intéresser à de nombreux phénomènes qui n'ont en commun qu'un intérêt entre l'espace et la littérature. Cet intérêt peut porter sur des phénomènes historiques ou sociologiques et leur inscription dans la géographie mondiale ou nationale (*littérature dans l'espace*); il peut également porter sur un aspect géographique intrinsèque à la fiction, construit à l'intérieur de la littérature (*l'espace dans la littérature*). Quant à la cartographie, elle peut être utilisée, ou non, comme outil d'analyse et de découverte dans l'un et l'autre cas, pour faire apparaître, rendre visibles des liens ou des phénomènes liés au sens de l'œuvre. De telles cartes peuvent s'appuyer sur les systèmes d'information géographique, comme celui utilisé par Google Maps, sur des cartes historiques, voire des cartes imaginaires et artistiques.

------------------------------------------------------------------------

## Concepts et défis de la cartographie : discussion autour du texte de Melanie Conroy

### La méfiance envers la cartographie littéraire

Dans l'introduction de son ouvrage, Melanie Conroy rappelle que la cartographie a souvent été rejetée par les spécialistes de la littérature. Même ceux qui s'intéressent à la géographie littéraire s'en méfient, car elle est considérée comme un geste «positiviste». Qu'est-ce qu'elle veut dire par là et quelles raisons les spécialistes peuvent-ils avoir de se méfier de la cartographie?

### Le processus cartographique

Conroy décrit un processus qui semble assez simple pour créer une carte littéraire:

1.  Extraire les noms de lieux (toponymes).
2.  Associer ces noms à des lieux réels via des répertoires (gazetteers).
3.  Géolocaliser (trouver les coordonnées latitude/longitude).
4.  Visualiser sur un fond de carte.

Dans les faits, cependant, ce processus n'est pas aussi aisé et suppose des choix de la part de la ou du cartographe.

Prenons un exemple simple. *La Comédie humaine* s'intéresse beaucoup à Paris. La première étape, celle de l'extraction du mot «Paris» (ou la «capitale») est facile. La deuxième étape est moins aisée. Pourquoi?

La troisième étape, celle de la géolocalisation, peut également poser quelques difficultés. Pourquoi? Conroy discute de cette étape en se référant à la «haussmannisation» de Paris au XIXe siècle.

### Des lieux, mais quels lieux?

Si l'on procède de manière automatique à l'extraction du mot «Paris» dans *La Comédie humaine*, nous obtiendrons une grande quantité d'occurrences. Cependant, dans le texte, le mot a-t-il toujours la même valeur et la même signification? Si je m'intéresse aux déplacements des personnages, le mot «Paris» en tant que tel sera plus ou moins pertinent. Pourquoi?

Barbara Piatti, qui a dirigé un ambitieux projet d'Atlas du roman européen, s'est beaucoup intéressée à un autre enjeu de la cartographie littéraire. Elle remarque en effet que les lieux littéraires, contrairement à ceux cartographiés scientifiquement, ont rarement des frontières claires. Ce sont souvent davantage des zones aux frontières floues que des lieux aux limites nettes. Elle propose une typologie des lieux en cinq points:

1.  `Setting`: un lieu où l'action prend place, occupé par les personnages;
2.  `Zone of action`: plusieurs `settings` formant une zone ou une région (ex.: région de Paris);
3.  `Projected space`: les personnages ne s'y trouvent pas, mais ils s'y réfèrent, s'en souviennent, aspirent à y aller, etc.;
4.  `Marker`: lieux mentionnés, par exemple par la narration, mais agissant davantage comme un point de repère dans l'espace que comme un lieu investi émotionnellement;
5.  `Route`: le long desquelles les personnages se déplacent (d'un `setting` à un autre).

## Pour aller plus loin

-   Mikhaïl Bakhtine, *Esthétique et théorie du roman*, traduit du russe par Daria Olivier, Paris, Gallimard, 1978 \[1975\].

-   Rachel Bouvet (éd.), *Littérature et géographie*, Montréal, Presses de l'Université du Québec, 2018.

-   Marc Brosseau, *Les romans-géographes. Essais*, Paris, L'Harmattan, coll. «Géographie et cultures», 1996.

-   Michel Collot, *Pour une géographie littéraire*, Paris, Éditions Corti, coll. «Les essais», 2014.

-   Melanie Conroy, *Literary Geographies in Balzac and Proust*, Cambridge, Cambridge University Press, coll. «Elements in Digital Literary Studies», 2021.

-   Franco Moretti, *Graphes, cartes et arbres. Modèles abstraits pour une autre histoire de la littérature*, traduit de l'anglais par Étienne Dobenesque, Paris, Les prairies ordinaires, coll. «Penser/croiser», 2008.

-   Barbara Piatti, Anne-Kathrin Reuschel, Hans Rudolf Bär, William Cartwright et Lorenz Hurni, «Mapping Literature. Towards a Geography of Fiction», dans Cartwright, W. et al. *Cartography and Art*, Wiesbaden, p. 177-192. <https://www.literaturatlas.eu/files/2012/01/Piatti2008_ArtAndCartography_Springer.pdf>

-   Muriel Rosemberg (dir.), *Géographie et cultures*, «Le roman policier. Lieux et itinéraires», no 61, 2007.

-   Lisa Teichmann, «Mapping German fiction in translation in the German National Library catalogue (1980-2020)», Department of Language, Literature and Culture, Université McGill, 2023. <https://escholarship.mcgill.ca/concern/theses/0p096d03z?locale=en>

------------------------------------------------------------------------

# II. Atelier de cartographie littéraire — Le Paris de *La Comédie humaine*

Pour ce premier atelier, nous allons utiliser les données compilées de diverses sources par Melanie Conroy dans le cadre de sa recherche sur la géographie balzacienne. Chemin faisant, nous allons faire nos premiers pas avec la structure de données la plus utilisée, le tableau de données.

## Consultation des données dans un logiciel

La première manière de consulter les données compilées par Conroy — et la plus simple —, est de passer par l'interface [`Tableau public`](https://public.tableau.com/app/profile/melanie.conroy/viz/BalzacsParis/BalzacsParis "Mapping Balzac - Tableau"). En cliquant sur le lien précédent, vous pourrez consulter trois graphiques exploitant les données.

1.  Une projection des lieux nommés sous forme de points: les couleurs sont associées à des titres d'ouvrages et la taille, au nombre d'occurrences;
2.  Une projection des lieux nommés dans un diagramme circulaire (tarte), avec les mêmes caractéristiques esthétiques;
3.  Un diagramme à barres montrant, pour chaque roman, l'importance des quartiers liés à des mentions de lieux.

**Exercice**:

1.  Sous l'onglet 3 (diagramme à barres), commencez par repérer le roman *Illusions perdues*. Quel est le quartier le plus important? Avez-vous une idée de ce qui s'y trouve et s'y passe?
2.  Sous l'onglet 2 (diagramme circulaire), repérez les lieux clés du Paris des œuvres de Balzac. Quels sont ces lieux et pourquoi sont-ils essentiels à la dynamique de *La Comédie humaine*?

------------------------------------------------------------------------

## Consultation des données brutes

L'interface graphique de Tableau est attrayante, mais elle est limitée: nous ne pouvons interagir qu'avec les données que l'auteure a souhaité montrer. Il peut être intéressant de retourner aux données brutes pour plusieurs raisons:

1.  Il est toujours utile et important de regarder l'état des données et de la structure. Dans certains cas, on peut rapidement repérer des problèmes de cohérence ou des enjeux d'uniformisation, puis les corriger.
2.  Les données pourraient être beaucoup plus riches que ne le laisse croire l'interface Tableau: il est possible que la structure brute contienne des colonnes permettant d'étendre l'enquête;
3.  Même si les données ne correspondent pas parfaitement à ce que nous cherchons, nous pourrons peut-être en extraire quelques éléments que nous pourrons ensuite enrichir.

Les données utilisées pour créer les graphiques de Tableau ont été déposées par Melanie Conroy sur son compte Github. Github est un espace de partage et de collaboration permettant aux programmeurs et développeurs de rendre publics du code et des données.

[`Mapping Balzac -- Github`](https://github.com/mrconroy/mapping-balzac "Mapping Balzac - Github")

Cliquez sur [`MappingBalzac_Paris_Comedie_Humaine.tsv`](https://github.com/mrconroy/mapping-balzac/blob/master/MappingBalzac_Paris_Comedie%20Humaine.tsv "MappingBalzac_Paris_Comedie_Humaine.tsv") pour voir l'état des données.

Que remarquez-vous?

## Consultation des données nettoyées

Un petit coup de balai est essentiel pour rendre ces données exploitables. Entre autres, les caractères latins ont été systématiquement corrigés à l'aide d'un logiciel spécialisé (OpenRefine).

En cliquant sur la flèche ![](images/clipboard-3589718497.png){width="20"} du bloc ci-dessous, Posit exécutera les lignes de commande et vous pourrez visualiser les trois premières lignes de la structure de données.

```{r}
#| label: setup
#| echo: true

# 1. Définition des noms de colonnes
noms_colonnes <- c(
  "livre", "book", "vol", "series", "series_ch", "start_page", "end_page",
  "region", "type_of_place", "place_raw", "place_raw_paris_france", "quartier",
  "lat", "long", "description", "types_involved", "characters_full_name",
  "characters_csv", "shop_name", "store_type", "historical_figures", "date",
  "wiki_url", "image_url", "discourse"
)

# 2. Importation et nettoyage initial des données
dt <- fread("donnees/MappingBalzacParis_final.csv", quote = "\"", col.names = noms_colonnes)

# Nettoyage des coordonnées dès l'importation.
# On s'assure que lat et long sont des nombres (numeric).
# na.omit() supprime les lignes où les coordonnées sont manquantes.
dt <- dt[, `:=`(lat = as.numeric(lat), long = as.numeric(long))][!is.na(lat) & !is.na(long)]

# Nettoyage de la variable 'discourse'
dt[is.na(discourse) | !(discourse %in% c("Fact", "Event", "Description")), discourse := "Autre"]

# Ajout d'un identifiant unique pour chaque ligne, utile pour les jointures
dt[, row_id := .I]

# Affichage des premières lignes pour vérification
datatable(head(dt, 3))
```

Cette structure de données, très commune, est une table plate ou «tableau de données» (*data frame* en anglais). Il comporte deux dimensions, avec des lignes et des colonnes. Si vous avez déjà travaillé avec Excel, vous ne serez pas perturbé outre mesure par cette structure.

**Question**: de quoi sont formées, ici, les lignes et les colonnes? Il est très important de comprendre cette structure pour pouvoir l'exploiter adéquatement.

**Question**: d'après vous, est-ce que toutes les colonnes ont été exploitées par Conroy dans l'interface Tableau?

### Partie 1 — Exploration des données, une dimension à la fois

Avant d'aller plus loin, faisons une petite pause terminologique.

Quand on travaille avec un tableau de données, il est utile d’avoir un vocabulaire simple et commun pour en parler. Quelques mots-clés suffisent pour commencer : **population**, **individus**, **variables**, **valeur** et **type de donnée**.

La **population** correspond à l’ensemble sur lequel porte notre observation. Par exemple, tous les livres ou articles de notre corpus.

On appellera **individus** chaque élément de cette population occupant une ligne du tableau, par exemple chaque livre ou article de notre corpus.

Enfin, on appellera **variables** les caractéristiques que nous mesurons ou notons pour chaque individu. Le nom de l'auteur, l'année de publication, la maison d'édition, les sujets dont traite chaque ouvrage du tableau.

Au croisement des lignes et des colonnes, donc des individus et des variables, se trouvent les **valeurs**.

Une **valeur**, c’est l’information précise enregistrée pour un individu donné sur une variable donnée.

• Exemple : si la variable est « âge », et que l’individu est Alice, la valeur peut être « 20 ».

Les **types de données.** Dans un tableau bien fait, toutes les valeurs d’une même variable doivent être du même type. C’est ce type qui détermine la nature des informations qu’on peut enregistrer et les opérations possibles.

Les principaux types de données sont : • chaînes de caractères (strings) : par exemple « Paris », « Nantes », « Angoulême » ; • nombres entiers (integers) : 1, 2, 3, 4 ; • nombres décimaux (floats) : 1.1, 1.5, 4.5 ; • booléens (booleans) : TRUE ou FALSE (oui/non, présent/absent).

👉 Dans une colonne donnée, on ne retrouve donc qu’un seul type de données, ce qui garantit la cohérence de la variable et la possibilité d’effectuer des calculs ou des regroupements pertinents.

Fin de la pause terminologique!

Devant un tableau comportant autant d'individus (4408) et de variables (25), on peut se sentir un peu perdu. Aussi, la première chose à faire est une exploration univariée, c'est-à-dire un regroupement des valeurs identiques d'une seule variable, question de voir l'importance de chaque groupe.

Dans le bloc suivant, nous allons créer notre premier regroupement: nous allons d'abord observer les différentes valeurs entrées par Melanie Conroy pour la variable `discourse`, puis nous allons calculer la fréquence de chacune de ces catégories.

```{r}

unique(dt$discourse)

```

```{r}
dt[, .N, discourse][order(-N)]
```

Nous pourrions proposer le même examen pour chacune des variables catégorielles (c'est-à-dire les variables pour lesquelles les valeurs sont des catégories, généralement en nombre limité). Essayez par exemple de remplacer `discourse` par `type_of_place` dans la dernière ligne de code, puis exécutez le bloc.

#### Notre premier diagramme à barres

Avec une table de fréquence comme celle que nous venons de composer, nous pouvons fabriquer un diagramme à barres. Chaque valeur de la variable correspondra à une barre et la hauteur de celle-ci sera déterminée par la fréquence (le nombre entier dans la deuxième colonne du tableau).

Le bloc ci-dessous offre une fonction maison permettant de créer un tel diagramme à barres pour une variable donnée. Changez par exemple la variable `discourse` par `type_of_place` dans la fonction, puis exécutez le bloc.

```{r}
#| label: "exploration_categorielle_avancee"
#| fig-cap: "Exploration des variables catégorielles avec options"
#| warning: false
#| message: false


plot_distribution <- function(data, variable, titre, max = 15, viridis = TRUE) {
  # Filtrage des valeurs vides ou manquantes
  data_filtrée <- data[get(variable) != "" & !is.na(get(variable))]
  
  # Comptage des occurrences
  freq <- data_filtrée[, .N, by = variable][order(-N)][1:max]
  noms_ordonnes <- freq[[variable]]
  
  # Sous-ensemble des données
  data_top <- data_filtrée[get(variable) %in% noms_ordonnes]
  
  # Tracé
  p <- ggplot(data_top, aes(x = reorder(get(variable), -table(get(variable))[get(variable)]))) +
    geom_bar(aes(fill = ..count..)) +
    labs(title = titre, x = variable, y = "Nombre de mentions") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
  
  # Option de coloration viridis
  if (viridis) {
    p <- p + scale_fill_viridis_c(option = "D", direction = -1, end = 0.9)
  }
  
  return(p)
}

plot_distribution(dt, "discourse", "Répartition des types de lieux")


```

À nouveau, changez `discourse` par une autre variable, `type_of_place`, puis exécutez à nouveau le bloc.

### Exploration cartographique

Comme le jeu de données de Melanie Conroy a été géoréférencé et que chaque entrée possède une valeur de latitude et une de longitude, il est possible de projeter chaque individu sur une carte sous la forme d'un petit point. Si vous retournez au [`premier onglet de Tableau -- Mapping Balzac`](https://public.tableau.com/app/profile/melanie.conroy/viz/BalzacsParis/BalzacsParis "Mapping Balzac"), vous verrez de ces points.

**Question**: pourquoi certains de ces points sont-ils plus volumineux?

Pour rendre la carte plus lisible, il est souvent souhaitable d'**agréger** les points qui occupent la même position géographique. Ainsi, la taille du point sera proportionnelle au nombre de fois que les coordonnées identiques se trouvent dans le jeu de données.

Une autre manière de simplifier et d'agréger les données géographiques est de les rassembler à l'intérieur d'une zone donnée de la carte, et de colorer la carte en fonction de la densité des points.

Dans le bloc de code ci-dessous, j'utilise la carte des arrondissements contemporains de Paris ([`données disponibles ici`](https://opendata.paris.fr/explore/dataset/arrondissements/export/?disjunctive.l_ar&disjunctive.c_arinsee&disjunctive.c_ar&location=13,48.85156,2.32327 "Arrondissements de Paris")). Chaque arrondissement est formé de coordonnées qui forment un polygone. On détermine combien de points uniques du jeu de données de Conroy «tombent» dans chaque polygone, puis on colore chaque polygone en fonction d'une échelle graduée. Ce type de carte est appelé **choroplèthe**.

```{r}
#| label: "preparation_carte_choroplethe"
#| message: false
#| warning: false

# --- Étape 1: Préparation des objets géospatiaux ---

# Chargement du fichier GeoJSON des arrondissements de Paris.
# st_transform(4326) s'assure que le système de coordonnées est le même que celui de nos points (WGS84).
arrondissements <- st_read("donnees/arrondissements.geojson", quiet = TRUE) |>
  st_transform(4326)

# Conversion de notre data.table en objet 'sf' (simple features).
# On spécifie que les colonnes 'long' et 'lat' sont les coordonnées.
points_sf <- st_as_sf(dt, coords = c("long", "lat"), crs = 4326, remove = FALSE)

# --- Étape 2: Jointure spatiale ---

# On effectue une jointure spatiale pour savoir dans quel arrondissement se trouve chaque point.
# `st_join` ajoute les colonnes des arrondissements (ex: c_ar, l_ar) aux points situés à l'intérieur.
points_avec_arrond <- st_join(points_sf, arrondissements, join = st_within)

# --- Étape 3: Comptage des mentions par arrondissement ---

# On repasse en data.table pour une agrégation rapide.
dt_final <- as.data.table(points_avec_arrond)

# On compte le nombre de mentions (N) par arrondissement (`l_ar`).
# On filtre les points qui n'ont pas trouvé d'arrondissement (NA).
comptes_arrond <- dt_final[!is.na(l_ar), .N, by = .(l_ar, c_ar)]
setnames(comptes_arrond, "N", "mentions") # On renomme la colonne pour plus de clarté

# --- Étape 4: Jointure des comptes au géo-référentiel ---

# On joint nos comptes à l'objet spatial 'arrondissements'.
# `merge` est utilisé ici pour la jointure.
arrondissements_avec_comptes <- merge(arrondissements, comptes_arrond, by = c("l_ar", "c_ar"), all.x = TRUE)

# On remplace les NA (arrondissements sans mention) par 0.
arrondissements_avec_comptes$mentions[is.na(arrondissements_avec_comptes$mentions)] <- 0


# --- Étape 5: Création de la carte interactive Leaflet ---

pal <- colorNumeric(palette = "viridis", domain = arrondissements_avec_comptes$mentions, reverse = TRUE)

carte_choroplethe <- leaflet(arrondissements_avec_comptes) %>%
  addTiles() %>%
  addPolygons(
    fillColor = ~pal(mentions),
    weight = 2,
    opacity = 1,
    color = "white",
    dashArray = "3",
    fillOpacity = 0.7,
    popup = ~paste(
      "<strong>Arrondissement :</strong>", l_ar, "<br>",
      "<strong>Nombre de mentions :</strong>", mentions, "<br>",
      "<strong>Pourcentage du total :</strong>",
      round(mentions / sum(mentions, na.rm = TRUE) * 100, 1), "%"
    ),
    highlightOptions = highlightOptions(
      weight = 3, color = "#666", dashArray = "",
      fillOpacity = 0.9, bringToFront = TRUE
    )
  ) %>%
  addLegend(
    pal = pal, values = ~mentions, opacity = 0.7,
    title = "Nombre de<br>mentions", position = "bottomright"
  ) %>%
  setView(lng = 2.34, lat = 48.86, zoom = 11)

carte_choroplethe
```

Le Paris de Balzac est fortement concentré autour des arrondissements centraux de la rive droite.

# Exploration avancée: l'analyse bivariée

À quel type de question l'analyse univariée permet-elle de répondre?

-   «Quels sont les lieux souvent mentionnés dans les romans de Balzac?»

Ce type d'exploration, une donnée à la fois, à l'aide de diagrammes à barres ou de cartes géographiques, permet certes de repérer des tendances fortes ou faibles, mais il ne permet pas encore de comprendre le lien *entre* les variables.

Pour cela, il faut croiser les valeurs de deux colonnes ou plus, et compter le nombre de fois que des paires de valeurs sont trouvées.

Supposons par exemple que j'aie créé un jeu de données dans lequel se trouve dix romans de Balzac (un par ligne) et que j'aie noté, pour chacun, le lieu du début du roman (lieu_debut) et le lieu où le roman se termine (lieu_fin).

```{r}

# Création du jeu de données exemple

balzac_romans <- data.frame(
  roman = c("Le Père Goriot", "Eugénie Grandet", "La Cousine Bette", 
            "Le Cousin Pons", "César Birotteau", "La Peau de chagrin",
            "Illusions perdues", "Splendeurs et misères", "La Femme de trente ans",
            "Le Lys dans la vallée"),
  lieu_debut = c("Paris", "Saumur", "Paris", "Paris", "Paris", "Paris",
                 "Angoulême", "Paris", "Paris", "Tours"),
  lieu_fin = c("Paris", "Saumur", "Paris", "Paris", "Paris", "Alpes",
               "Paris", "Paris", "Normandie", "Tours"),
  annee_publication = c(1835, 1833, 1846, 1847, 1837, 1831, 1843, 1847, 1842, 1836)
)

# Affichage du tableau
balzac_romans
```

Dans le contexte d'une analyse bivariée, on posera des questions comme les suivantes:

«Y a-t-il une **relation** entre le lieu de début et le lieu de fin des romans ?» «Les romans qui commencent à Paris finissent-ils généralement à Paris ?» «Observe-t-on des patterns de mobilité géographique selon l'époque de publication ?»

Pour répondre à ce type de question, il faut construire un petit tableau où nous noterons le nombre d'occurrences de chaque paire. C'est ce qu'on appelle un tableau de contingence

```{r}
# Tableau de contingence : lieu_debut × lieu_fin
tableau_cooc <- table(balzac_romans$lieu_debut, balzac_romans$lieu_fin)
print(tableau_cooc)

# Ou avec dplyr pour plus de flexibilité
contingence <- balzac_romans %>%
  count(lieu_debut, lieu_fin, name = "frequence") %>%
  arrange(desc(frequence))

print(contingence)
```

Les données d'un tableau de contingence peuvent être projetés dans une carte de chaleur:

```{r}

# Heatmap pour visualiser les croisements
ggplot(contingence, aes(x = lieu_debut, y = lieu_fin, fill = frequence)) +
  geom_tile() +
  geom_text(aes(label = frequence), color = "white", size = 4) +
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  labs(title = "Carte de chaleur de la mobilité géographique",
       x = "Lieu de début", 
       y = "Lieu de fin",
       fill = "Fréquence") +
  theme_minimal()
```

Nous allons maintenant faire cela avec de «vraies» données, cette fois, celles du tableau de Melanie Conroy.

Nous allons, en guise d'exemple, croiser les modalités de la variable **série littéraire** («Scènes de la vie parisienne», «Scènes de la vie de province», etc.) et celles de la variable **région géographique** pour vérifier que Balzac situe bien en province les «Scènes de la vie de province»!

Les noms de variables à utiliser ici sont `series_ch` pour la série littéraire et `region` pour la région géographique.

```{r}
#| label: "preparation_heatmap"
#| warning: false
#| message: false


# Nettoyage des valeurs vides
dt_filtré <- dt[series_ch != "" & !is.na(series_ch) & region != "" & !is.na(region)]

# Création de la matrice de cooccurrences
matrice_cooc <- dcast(
  dt_filtré[, .N, by = .(series_ch, region)],
  series_ch ~ region,
  value.var = "N",
  fill = 0
)

# Aperçu des données agrégées
head(matrice_cooc)
```

Le bloc suivant, quant à lui, crée la carte de chaleur et rend visible les croisements de données.

```{r}
#| label: "plot_heatmap_simple"
#| fig-cap: "Carte de chaleur simplifiée"
#| warning: false
#| message: false

# Fonction simplifiée pour tracer une carte de chaleur à partir d'une matrice
plot_heatmap <- function(matrice, titre = "Carte de chaleur") {
  
  # Conversion en format long
  data_long <- melt(matrice, id.vars = colnames(matrice)[1], variable.name = "colonne", value.name = "N")
  
  ggplot(data_long, aes_string(x = "colonne", y = colnames(matrice)[1], fill = "N")) +
    geom_tile(color = "white") +
    scale_fill_viridis_c(option = "C", direction = -1) +
    labs(title = titre, x = "Variable 2", y = "Variable 1", fill = "Fréquence") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
}

plot_heatmap(matrice_cooc, "Carte de chaleur : séries × régions")

```

On n'est pas surpris de voir que les *Scènes de la vie parisienne* sont **fortement corrélées** avec la Cité et les Boulevards, où l'on trouve les théâtres et les divertissements, mais il est plus surprenant de voir que les *Scènes de la vie de province* contiennent également un nombre élevé de références aux mêmes Boulevards. Avez-vous une hypothèse pour expliquer ce phénomène?

Nous pouvons isoler, dans table initiale, les romans des *Scènes de la vie de province* et voir lesquels font le plus souvent référence aux Boulevards.

```{r}

dt_pie <- dt[series_ch == "Scènes de la vie de province" & region == "The Boulevards",
             .N, by = "livre"][order(-N)]
dt_pie
dt_pie |>
  ggplot(aes(x = "", y = N, fill = reorder(livre, -N))) +
  geom_bar(stat = "identity", width = 1, color = "white") +
  geom_text(aes(label = N),   # <- ajouter les étiquettes
            position = position_stack(vjust = 0.5),  # centre
            color = "white",                         # couleur contrastée
            size = 4) +                               # taille ajustable
  coord_polar("y", start = 0) +
  theme_void()


```

Ainsi, *Illusions perdues* est le titre des *Scènes de la vie de province* qui se réfère le plus à Paris et, comme on sait, toute la partie centrale du roman, «Un grand homme de province à Paris», s'y déroule.
